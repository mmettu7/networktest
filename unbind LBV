---
- name: Check LBVserver bound to CSVserver on Netscaler
  hosts: netscaler
  gather_facts: no

  tasks:
    - name: Get LBVserver bindings
      uri:
        url: "http://{{ netscaler_ip }}/nitro/v1/config/lbvserver_binding/{{ lbvserver_name }}"
        method: GET
        user: "{{ netscaler_username }}"
        password: "{{ netscaler_password }}"
        force_basic_auth: yes
        validate_certs: no
      register: lbvserver_binding_result

    - name: Print LBVserver to CSVserver binding status
      debug:
        msg: >
          LBVserver {{ lbvserver_name }} is
          {% if lbvserver_binding_result.status == 200 %}
          bound to CSVserver
          {% else %}
          not bound to any CSVserver
          {% endif %}
